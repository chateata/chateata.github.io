import{_ as q,h as L,j as G,l as P,a as V,k as F,c as m,o as g,b as s,e as i,w as c,g as k,f as u,n as A,F as S,q as E,t as H,v as O,x as K,y as v,B as N,C as Q,A as j,u as U,D as W,E as M,m as J}from"./index-BaLn3tjY.js";import{g as h}from"./index-o8MNB0H_.js";import{targetAPI as X}from"./index-Dr8YfNte.js";import"./index-NIGUFBhG.js";const Y={name:"TargetSearch",components:{ArrowLeft:F,Aim:V,Loading:P,ArrowRight:G,Position:L},setup(){const w=j(),t=U(),p=v(""),o=v(!1),_=v(!1),l=v(null),x=v([{id:"ENSG00000139618",name:"BRCA2"},{id:"ENSG00000157764",name:"BRAF"},{id:"ENSG00000141510",name:"TP53"}]),n=v([]),C=()=>{n.value.length===0&&n.value.push({id:h(),type:"agent",content:"您好！我是OmniMedical，请输入靶点ID（Ensembl ID）来搜索相关药物信息。",timestamp:new Date})},d=()=>{Q(()=>{const a=document.querySelector(".chat-messages-container");a&&a.scrollTo({top:a.scrollHeight,behavior:"smooth"})})};N(n,()=>{d()},{deep:!0}),N(_,a=>{a||setTimeout(()=>{d()},100)});const y=a=>{p.value=a,b("靶点ID已复制到输入框")},b=a=>{const e=document.createElement("div");e.textContent=a,e.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: #56ab2f;
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        z-index: 1000;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(86, 171, 47, 0.3);
        animation: slideInRight 0.3s ease-out;
      `,document.body.appendChild(e),setTimeout(()=>{document.body.removeChild(e)},2e3)},T=async()=>{var e,f;if(!p.value.trim())return;const a=p.value.trim();n.value.push({id:h(),type:"user",content:`搜索靶点：${a}`,timestamp:new Date}),o.value=!0,d(),n.value.push({id:h(),type:"agent",content:`正在搜索靶点 ${a} 的信息...`,timestamp:new Date}),_.value=!0,d();try{console.log("开始搜索靶点:",a);const r=await X.getTargetInfo(a);if(console.log("靶点搜索响应:",r),r&&r.code===0&&r.data){l.value=r.data,console.log("设置靶点信息:",l.value);const z=l.value.name||l.value.symbol||a,R=((e=l.value.drugs)==null?void 0:e.uniqueDrugs)||0,B=((f=l.value.drugs)==null?void 0:f.count)||0;let I=`已找到靶点 ${z} 的信息。`;R>0&&(I+=`

发现 ${R} 个唯一药物，共 ${B} 条记录。`,I+=`

点击"查看详情"按钮可以查看完整的药物列表和详细信息。`),n.value.push({id:h(),type:"agent",content:I,timestamp:new Date,hasResults:!0}),d()}else throw new Error((r==null?void 0:r.msg)||"搜索失败")}catch(r){console.error("靶点搜索失败:",r),n.value.push({id:h(),type:"agent",content:`抱歉，搜索靶点 ${a} 时出现错误：${r.message||"网络错误，请稍后重试"}`,timestamp:new Date,hasResults:!1}),d(),l.value=null}finally{_.value=!1}p.value=""},D=()=>{l.value&&(w.dispatch("setCurrentTarget",l.value.id),l.value.drugs&&w.dispatch("setGeneratedDrugs",l.value.drugs),t.push("/target-drugs"))};return C(),d(),{targetInput:p,hasStarted:o,loading:_,targetChatHistory:n,targetInfo:l,quickTargets:x,sendMessage:T,selectQuickTarget:y,viewTargetDetails:D,showMessage:b}}},Z={class:"target-search"},$={class:"header"},tt={class:"chat-container"},et={class:"chat-view"},st={class:"chat-messages-container"},at={class:"chat-messages"},ot={class:"message-content"},nt={key:0,class:"agent-info"},it={class:"ai-avatar-content"},lt={class:"message-text"},rt={key:1,class:"view-details"},dt={key:0,class:"message agent loading-message"},ct={class:"message-content"},ut={class:"agent-info"},gt={class:"ai-avatar-content"},mt={class:"message-text"},pt={class:"input-area"},vt={class:"quick-targets"},_t={class:"input-group"},ft=["disabled"];function ht(w,t,p,o,_,l){const x=u("ArrowLeft"),n=u("el-icon"),C=u("el-button"),d=u("Aim"),y=u("el-avatar"),b=u("ArrowRight"),T=u("Loading"),D=u("el-tag"),a=u("Position");return g(),m("div",Z,[s("div",$,[i(C,{onClick:t[0]||(t[0]=e=>w.$router.push("/")),type:"text",class:"back-btn"},{default:c(()=>[i(n,null,{default:c(()=>[i(x)]),_:1}),t[5]||(t[5]=k(" 返回首页 ",-1))]),_:1,__:[5]}),t[6]||(t[6]=s("h1",null,"基于靶点筛选",-1)),t[7]||(t[7]=s("p",null,"输入靶点ID，搜索相关药物信息",-1))]),s("div",tt,[s("div",et,[s("div",st,[s("div",at,[(g(!0),m(S,null,E(o.targetChatHistory,e=>(g(),m("div",{key:e.id,class:W(["message",e.type])},[s("div",ot,[e.type==="agent"?(g(),m("div",nt,[i(y,{size:40,class:"ai-avatar"},{default:c(()=>[s("div",it,[i(n,{size:"20",color:"#56ab2f"},{default:c(()=>[i(d)]),_:1})])]),_:1}),t[8]||(t[8]=s("span",{class:"agent-name"},"OmniMedical",-1))])):A("",!0),s("div",lt,M(e.content),1),e.type==="agent"&&e.hasResults&&o.targetInfo?(g(),m("div",rt,[s("button",{onClick:t[1]||(t[1]=(...f)=>o.viewTargetDetails&&o.viewTargetDetails(...f)),class:"view-details-btn"},[t[9]||(t[9]=s("span",null,"查看详情",-1)),i(n,null,{default:c(()=>[i(b)]),_:1})])])):A("",!0)])],2))),128)),o.loading?(g(),m("div",dt,[s("div",ct,[s("div",ut,[i(y,{size:40,class:"ai-avatar"},{default:c(()=>[s("div",gt,[i(n,{size:"20",color:"#56ab2f"},{default:c(()=>[i(d)]),_:1})])]),_:1}),t[10]||(t[10]=s("span",{class:"agent-name"},"OmniMedical",-1))]),s("div",mt,[i(n,{class:"is-loading"},{default:c(()=>[i(T)]),_:1}),t[11]||(t[11]=k(" 正在搜索中，请稍候... ",-1))])])])):A("",!0)])]),s("div",pt,[s("div",vt,[(g(!0),m(S,null,E(o.quickTargets,e=>(g(),J(D,{key:e.id,onClick:f=>o.selectQuickTarget(e.id),class:"quick-target-tag",type:"info",effect:"light"},{default:c(()=>[k(M(e.name)+" ("+M(e.id)+") ",1)]),_:2},1032,["onClick"]))),128))]),s("div",_t,[H(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.targetInput=e),placeholder:"请输入靶点ID，例如：ENSG00000139618",class:"form-control",onKeyup:t[3]||(t[3]=K((...e)=>o.sendMessage&&o.sendMessage(...e),["enter"]))},null,544),[[O,o.targetInput]]),s("button",{onClick:t[4]||(t[4]=(...e)=>o.sendMessage&&o.sendMessage(...e)),disabled:!o.targetInput.trim(),class:"btn btn-primary"},[i(n,null,{default:c(()=>[i(a)]),_:1}),t[12]||(t[12]=k(" 发送 ",-1))],8,ft)])])])])])}const xt=q(Y,[["render",ht],["__scopeId","data-v-adec1ac8"]]);export{xt as default};
