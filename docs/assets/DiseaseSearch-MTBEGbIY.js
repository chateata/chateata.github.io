import{_ as O,h as W,i as Q,l as F,j as K,a as j,k as U,c as p,o as l,m as I,b as t,e as d,w as c,g as M,f as u,n as S,F as A,q as B,t as G,v as J,x as X,y as m,z,A as Y,B as q,C as Z,u as $,D as ee,E}from"./index-BaLn3tjY.js";import{g as v}from"./index-o8MNB0H_.js";import{diseaseAPI as se}from"./index-Dr8YfNte.js";import{T as te}from"./TargetList-BWr0V1rQ.js";import"./index-NIGUFBhG.js";const ae={name:"DiseaseSearch",components:{ArrowLeft:U,Aim:j,ArrowRight:K,Loading:F,ChatDotRound:Q,Position:W,TargetList:te},setup(){const n=Y(),e=$(),h=m(""),a=m(!1),w=m(!1),b=m(!1),y=m(""),f=z(()=>n.getters.chatHistory),g=z(()=>n.getters.searchResults),k=z(()=>n.getters.loading),r=()=>{Z(()=>{const s=document.querySelector(".chat-messages-container");s&&s.scrollTo({top:s.scrollHeight,behavior:"smooth"})})};q(f,()=>{r()},{deep:!0}),q(k,s=>{s||setTimeout(()=>{r()},100)}),(()=>{f.value.find(i=>i.content==="您好，我是OmniMedical，您的药物生成助手，请问您想针对什么疾病生成药物？")||n.dispatch("addMessage",{id:v(),type:"agent",content:"您好，我是OmniMedical，您的药物生成助手，请问您想针对什么疾病生成药物？",timestamp:new Date})})(),r();const x=s=>{const i=document.createElement("div");i.textContent=s,i.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: #56ab2f;
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        z-index: 1000;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(86, 171, 47, 0.3);
        animation: slideInRight 0.3s ease-out;
      `,document.body.appendChild(i),setTimeout(()=>{document.body.removeChild(i)},2e3)},C=async()=>{if(!h.value.trim())return;const s=h.value.trim();n.dispatch("addMessage",{id:v(),type:"user",content:s,timestamp:new Date}),n.dispatch("setCurrentDisease",s),a.value=!0,n.dispatch("addMessage",{id:v(),type:"agent",content:`正在为您搜索${s}相关疾病信息...`,timestamp:new Date,hasResults:!1}),n.dispatch("setLoading",!0),w.value=!0,r();try{const i=await se.searchDisease(s,!1);if(i.code===0&&i.data){const P=i.data.results||[],V=i.data.count||0,H=P.map((_,N)=>({id:_.id||`disease_${N+1}`,name:_.name||"",description:_.description||"",therapeutic_area:_.therapeutic_area||"",original_id:_.id,original_name:_.name,original_description:_.description}));n.dispatch("setSearchResults",H),n.dispatch("addMessage",{id:v(),type:"agent",content:`已找到${V}个与${s}相关的疾病信息。`,timestamp:new Date,hasResults:!0}),r()}else throw new Error(i.msg||"搜索失败")}catch(i){console.error("疾病搜索失败:",i),n.dispatch("addMessage",{id:v(),type:"agent",content:`抱歉，搜索${s}时出现错误：${i.message||"网络错误，请稍后重试"}`,timestamp:new Date,hasResults:!1}),n.dispatch("setSearchResults",[]),r()}finally{n.dispatch("setLoading",!1),w.value=!1}},R=s=>{y.value=s.original_id,n.dispatch("setCurrentDiseaseId",s.original_id),b.value=!0},L=s=>{console.log("选中的靶点:",s),n.dispatch("setCurrentTarget",s.id),e.push("/target-drugs")},o=()=>{e.push("/search-results")},D=m(["Alzheimer disease","Parkinson disease","Multiple sclerosis","Epilepsy","Stroke","Migraine"]);return{diseaseInput:h,hasStarted:a,loading:w,chatHistory:f,searchResults:g,isLoading:k,showTargetList:b,currentDiseaseId:y,sendMessage:C,selectTarget:R,handleTargetSelect:L,showMessage:x,viewSearchResults:o,quickDiseases:D,selectQuickDisease:s=>{h.value=s,x("疾病名称已复制到输入框")},scrollToBottom:r}}},oe={class:"disease-search"},ne={key:1},ie={class:"header"},de={class:"chat-container"},re={class:"chat-view"},le={class:"chat-messages-container"},ce={class:"chat-messages"},ue={class:"message-content"},ge={key:0,class:"agent-info"},pe={class:"ai-avatar-content"},_e={class:"message-text"},me={key:1,class:"view-details"},he={key:0,class:"message agent loading-message"},fe={class:"message-content"},ve={class:"agent-info"},we={class:"ai-avatar-content"},ye={class:"message-text"},ke={class:"input-area"},xe={class:"quick-diseases"},De={class:"input-group"},Me=["disabled"];function be(n,e,h,a,w,b){const y=u("TargetList"),f=u("ArrowLeft"),g=u("el-icon"),k=u("el-button"),r=u("ChatDotRound"),T=u("el-avatar"),x=u("ArrowRight"),C=u("Loading"),R=u("el-tag"),L=u("Position");return l(),p("div",oe,[a.showTargetList?(l(),I(y,{key:0,"disease-id":a.currentDiseaseId,onBack:e[0]||(e[0]=o=>a.showTargetList=!1),onSelectTarget:a.handleTargetSelect},null,8,["disease-id","onSelectTarget"])):(l(),p("div",ne,[t("div",ie,[d(k,{onClick:e[1]||(e[1]=o=>n.$router.push("/")),type:"text",class:"back-btn"},{default:c(()=>[d(g,null,{default:c(()=>[d(f)]),_:1}),e[6]||(e[6]=M(" 返回首页 ",-1))]),_:1,__:[6]}),e[7]||(e[7]=t("h1",null,"基于疾病搜寻疾病信息",-1))]),t("div",de,[t("div",re,[t("div",le,[t("div",ce,[(l(!0),p(A,null,B(a.chatHistory,o=>(l(),p("div",{key:o.id,class:ee(["message",o.type])},[t("div",ue,[o.type==="agent"?(l(),p("div",ge,[d(T,{size:40,class:"ai-avatar"},{default:c(()=>[t("div",pe,[d(g,{size:"20",color:"#56ab2f"},{default:c(()=>[d(r)]),_:1})])]),_:1}),e[8]||(e[8]=t("span",{class:"agent-name"},"OmniMedical",-1))])):S("",!0),t("div",_e,E(o.content),1),o.type==="agent"&&o.hasResults&&a.searchResults.length>0?(l(),p("div",me,[t("button",{onClick:e[2]||(e[2]=(...D)=>a.viewSearchResults&&a.viewSearchResults(...D)),class:"view-details-btn"},[e[9]||(e[9]=t("span",null,"查看详情",-1)),d(g,null,{default:c(()=>[d(x)]),_:1})])])):S("",!0)])],2))),128)),a.isLoading?(l(),p("div",he,[t("div",fe,[t("div",ve,[d(T,{size:40,class:"ai-avatar"},{default:c(()=>[t("div",we,[d(g,{size:"20",color:"#56ab2f"},{default:c(()=>[d(r)]),_:1})])]),_:1}),e[10]||(e[10]=t("span",{class:"agent-name"},"OmniMedical",-1))]),t("div",ye,[d(g,{class:"is-loading"},{default:c(()=>[d(C)]),_:1}),e[11]||(e[11]=M(" 正在搜索中，请稍候... ",-1))])])])):S("",!0)])]),t("div",ke,[t("div",xe,[(l(!0),p(A,null,B(a.quickDiseases,o=>(l(),I(R,{key:o,onClick:D=>a.selectQuickDisease(o),class:"quick-disease-tag",type:"info",effect:"light"},{default:c(()=>[M(E(o),1)]),_:2},1032,["onClick"]))),128))]),t("div",De,[G(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.diseaseInput=o),placeholder:"请输入疾病名称",class:"form-control",onKeyup:e[4]||(e[4]=X((...o)=>a.sendMessage&&a.sendMessage(...o),["enter"]))},null,544),[[J,a.diseaseInput]]),t("button",{onClick:e[5]||(e[5]=(...o)=>a.sendMessage&&a.sendMessage(...o)),disabled:!a.diseaseInput.trim(),class:"btn btn-primary"},[d(g,null,{default:c(()=>[d(L)]),_:1}),e[12]||(e[12]=M(" 发送 ",-1))],8,Me)])])])])]))])}const Ie=O(ae,[["render",be],["__scopeId","data-v-1a16d4a9"]]);export{Ie as default};
