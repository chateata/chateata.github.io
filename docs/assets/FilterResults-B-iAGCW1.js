const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Dr8YfNte.js","assets/index-NIGUFBhG.js"])))=>i.map(i=>d[i]);
import{_ as he,R as ye,I as De,l as be,X as Pe,L as ke,M as Me,d as ze,a5 as Ae,a6 as Re,a7 as Te,a8 as Ie,k as Ee,c as f,o as d,b as e,e as a,w as _,g as R,f as b,n as C,F as le,q as ae,E as g,m as F,y as A,z as pe,O as Se,A as we,a9 as Le,aa as ve,W as T,u as Ce,a4 as Ue,D as fe}from"./index-BaLn3tjY.js";import{a as ce}from"./index-NIGUFBhG.js";import{R as Oe,r as Fe,a as Be}from"./rightlist-BSXjGzwz.js";import"./index-Bn9PLWWT.js";const Ve={name:"FilterResults",components:{ArrowLeft:Ee,Trophy:Ie,Medal:Te,Star:Re,InfoFilled:Ae,DataAnalysis:ze,Connection:Me,Collection:ke,View:Pe,Loading:be,articleDetail:Be,rightlist:Fe,RaddarChart:Oe,MagicStick:De,Refresh:ye},setup(){Ue();const Z=Ce(),s=we(),B=A(1),t=A(!1),$=pe(()=>!m.value||!m.value.top_drugs?0:Math.min(m.value.top_drugs.length,3)),m=A({top_drugs:[]}),U=A(null),y=A(!1),w=A({smiles:"",molecular_Weight:0}),ie=A([{mode:"提高水溶性",description:"增加药物在水中的溶解度，使其更容易被机体吸收"},{mode:"提升生物利用度",description:"增强药物被机体吸收的比例和速率，提高药效"},{mode:"降低毒性",description:"通过结构修饰等方式，减少药物对人体的副作用和毒性反应"},{mode:"改善药物稳定性",description:"增强药物在储存和体内环境中的化学、物理稳定性，防止分解失效"},{mode:"增强选择性/靶向性",description:"使药物更精准地作用于目标蛋白或疾病病灶部位，减少对正常组织的影响"},{mode:"改善药代动力学性质",description:"优化药物的吸收、分布、代谢和排泄等过程，以获得理想的体内行为和剂量控制"}]),W=A(""),H=A(5),I=A(!1),V=A(""),j=A(0),K=A(null),k=A(null),G=A(null),x=A(null),N=A(!1),L=A({smiles:"",molecular_Weight:0}),D=pe(()=>{if(!m.value||!m.value.top_drugs||!m.value.top_drugs.length)return null;const l=m.value.top_drugs[B.value-1];return l&&console.log(`当前选中TOP ${B.value}，药物: ${l.drug_metadata.name}，排名: ${l.final_rank}`),l||null}),ee=l=>{var n,r;l<=$.value&&l>0?(B.value=l,console.log(`切换到TOP ${l}，药物: ${(n=D.value)==null?void 0:n.drug_metadata.name}，排名: ${(r=D.value)==null?void 0:r.final_rank}`),D.value&&D.value.drug_smiles&&J(D.value.drug_smiles)):console.warn(`无效的TOP排名: ${l}，可用范围: 1-${$.value}`)},se=l=>{if(!l)return"未提供";const n=l.split("/");return n[n.length-1]||l},J=async l=>{var n,r,i,c,o,u,P,E,S,z,M;if(!l||l==="Unknown"){console.log("无效的SMILES，跳过ADMET数据获取");return}try{y.value=!0,console.log("开始获取ADMET数据，SMILES:",l),w.value.smiles=l,w.value.molecular_Weight=((r=(n=D.value)==null?void 0:n.scoring_data)==null?void 0:r.bioscore)||0;const{drugAnalysisAPI:v}=await ve(async()=>{const{drugAnalysisAPI:q}=await import("./index-Dr8YfNte.js");return{drugAnalysisAPI:q}},__vite__mapDeps([0,1])),O={smiles:l,disease:"cancer",include_images:!0,include_radar_chart:!0};console.log("准备调用ADMET API，参数:",O),console.log("API地址: http://119.45.252.149:3395/api/drug/analyze");const h=await v.analyze(O);if(console.log("ADMET API响应:",h),console.log("API响应状态:",h.code),console.log("API响应消息:",h.msg),console.log("API响应数据:",h.data),h.data){const q=h.task_id||h.data.task_id;console.log("ADMET分析任务ID:",q);const Y=h.data.Image_Paths||{};console.log("ADMET图片路径信息:",Y),U.value={Radar_Chart_Data:h.data.Radar_Chart_Data||{Properties:["分子量","LogP","TPSA","氢键受体数","氢键供体数","可旋转键数"],Values:[((i=h.data.Physical_Chemical_Properties)==null?void 0:i["Molecular Weight"])||w.value.molecular_Weight,((c=h.data.Physical_Chemical_Properties)==null?void 0:c.LogP)||0,((o=h.data.Physical_Chemical_Properties)==null?void 0:o.TPSA)||0,((u=h.data.Physical_Chemical_Properties)==null?void 0:u["H-Bond Acceptors"])||0,((P=h.data.Physical_Chemical_Properties)==null?void 0:P["H-Bond Donors"])||0,((E=h.data.Physical_Chemical_Properties)==null?void 0:E["Rotatable Bonds"])||0],Upper_Limits:[500,5,140,10,5,10],Lower_Limits:[150,-1,20,0,0,0]},Physical_Chemical_Properties:h.data.Physical_Chemical_Properties||{},ADMET_Properties:h.data.ADMET_Properties||{},Disease_Related_Predictions:h.data.Disease_Related_Predictions||{},SIDER_Predictions:h.data.SIDER_Predictions||{},Image_Paths:Y,task_id:q,SMILES:l},console.log("ADMET数据格式化成功:",U.value),console.log("admetData.value 已设置，组件应该能接收到数据"),console.log("验证admetData设置:"),console.log("- admetData.value存在:",!!U.value),console.log("- Physical_Chemical_Properties:",U.value.Physical_Chemical_Properties),console.log("- ADMET_Properties:",U.value.ADMET_Properties),console.log("- SMILES:",U.value.SMILES)}else throw new Error("API响应数据格式错误: 缺少data字段")}catch(v){console.error("获取ADMET数据失败:",v),console.error("错误详情:",{message:v.message,response:v.response,status:(S=v.response)==null?void 0:S.status,statusText:(z=v.response)==null?void 0:z.statusText,data:(M=v.response)==null?void 0:M.data}),T.error("ADMET数据获取失败: "+(v.message||"未知错误")),U.value={Radar_Chart_Data:{Properties:["分子量","LogP","TPSA","氢键受体数","氢键供体数","可旋转键数"],Values:[w.value.molecular_Weight,2.5,85.4,6,2,4],Upper_Limits:[500,5,140,10,5,10],Lower_Limits:[150,-1,20,0,0,0]},Physical_Chemical_Properties:{"Molecular Weight":w.value.molecular_Weight,LogP:2.5,TPSA:85.4,"H-Bond Acceptors":6,"H-Bond Donors":2,"Rotatable Bonds":4},ADMET_Properties:{Absorption:{Human_Intestinal_Absorption:{predicted_class:"High",confidence:.85}},Distribution:{},Metabolism:{},Excretion:{},Toxicity:{}},Disease_Related_Predictions:{},SIDER_Predictions:{},Image_Paths:{},task_id:null,SMILES:l},console.log("使用模拟ADMET数据作为后备")}finally{y.value=!1,console.log("ADMET数据获取完成，loading状态:",y.value)}},ne=async()=>{var l,n,r,i;if(!t.value){try{t.value=!0;const o=JSON.stringify({smiles:((l=D.value)==null?void 0:l.drug_smiles)||"Unknown",currentPdbId:s.state.currentPdbId,selectedDisease:s.state.selectedDisease,multiscoreResults:s.state.multiscoreResults})+"你是一位药物递送系统设计专家，需基于提供的药物元数据（含SMILES、理化性质、靶点及疾病信息），生成符合药物递进的分析结果。输出必须包含实际数值和关联分析。核心分析提示：1. 粒径分布需结合药物分子量和靶点定位，最优区间需平衡组织穿透性与靶向效率 2. 载体类型选择需优先匹配低水溶性和高靶向需求 3. 释放曲线需关联半衰期和毒性风险，避免爆发释放过高导致毒副作用 4. 生物分布需重点体现肿瘤靶向性，同时关注转移灶(肺、肝)的药物富集 5. 综合评分需结合稳定性评分、ADMET评分等多维度参数";console.log("当前递进分子的SMILES："+((n=D.value)==null?void 0:n.drug_smiles)||"Unknown");const u=JSON.stringify({smiles:((r=D.value)==null?void 0:r.drug_smiles)||"Unknown",requirements:o,timeout:300,verbose:!1});console.log("请求数据"+u);const E=await ce({method:"post",url:"/drug-delivery/analyze",headers:{"Content-Type":"application/json"},data:u});console.log(JSON.stringify(E.data)),s.dispatch("setDrugDeliveryApiData",E.data),Z.push("/drug-delivery")}catch(c){console.error("药物递进分析失败:",c),T.error("药物递进分析失败: "+(c.message||"未知错误"))}finally{t.value=!1,console.log("药物递进分析完成，loading状态:",t.value)}JSON.stringify({smiles:((i=D.value)==null?void 0:i.drug_smiles)||"Unknown",currentPdbId:s.state.currentPdbId,selectedDisease:s.state.selectedDisease,multiscoreResults:s.state.multiscoreResults})}},re=async()=>{var l,n,r,i,c;try{const o=((n=(l=D.value)==null?void 0:l.drug_metadata)==null?void 0:n.name)||((r=D.value)==null?void 0:r.boltz_drug_name)||"Unknown";console.log("当前药物名称:",o);let u=s.getters.multiscoreResultUrls;if(!u){const M=s.state.multiscoreResults;M&&M.resultUrls&&(u=M.resultUrls,console.log("从multiscoreResults中获取到resultUrls:",u))}if(console.log("最终使用的Multiscore结果URLs:",u),console.log("Store state multiscoreResultUrls:",s.state.multiscoreResultUrls),console.log("Store getters multiscoreResultUrls:",s.getters.multiscoreResultUrls),!u||!u.pli_files){T.warning("未找到分子对接文件信息");return}const P=u.pli_files,E=Object.keys(P).find(M=>M.includes(o)),S=E?P[E]:null;if(S)console.log(`找到药物 ${o} 的文件信息:`,S),s.dispatch("setPDBViewerFiles",{proteinFile:S.protein_file,ligandFile:S.ligand_file,drugName:o});else{console.warn(`未找到药物 ${o} 对应的文件信息`);const M=u.pli_files.Unknown;if(M)console.log("使用Unknown作为默认文件:",M),s.dispatch("setPDBViewerFiles",{proteinFile:M.protein_file,ligandFile:M.ligand_file,drugName:o});else{T.error("未找到可用的分子对接文件");return}}s.dispatch("setFilterResults",{currentDrug:D.value,activeTopDrug:B.value,allResults:m.value.top_drugs});const z=((c=(i=D.value)==null?void 0:i.scoring_data)==null?void 0:c.bioscore)||0;s.dispatch("setPDBViewerBioscore",z),console.log("存储bioscore分数到store:",z),Z.push("/pdb-viewer")}catch(o){console.error("跳转PDB查看器时出错:",o),T.error("跳转失败，请重试")}},te=async()=>{var l,n;if(!((l=D.value)!=null&&l.drug_smiles)||!W.value||!H.value){T.warning("请选择优化模式和数量");return}try{I.value=!0,j.value=0,K.value=null,console.log("开始分子优化:",{mode:W.value,smiles:D.value.drug_smiles,count:H.value});const r=await ce.post("/molecular-optimization/optimize-async",{mode:W.value,smiles:D.value.drug_smiles,count:H.value,api_key_csv:"APIkey_pool.csv"},{headers:{"Content-Type":"application/json"},timeout:3e4});if(console.log("优化任务启动响应:",r.data),r.data&&r.data.task_id)V.value=r.data.task_id,T.success("优化任务已启动，正在监控进度..."),Q();else throw new Error("未获取到任务ID")}catch(r){console.error("启动分子优化失败:",r),r.code==="ERR_NETWORK"||r.message.includes("CORS")?T.error("网络请求失败，可能是跨域问题。请检查网络连接或联系管理员。"):r.response?T.error(`服务器错误: ${r.response.status} - ${((n=r.response.data)==null?void 0:n.message)||"未知错误"}`):r.request?T.error("请求超时，请检查网络连接"):T.error("启动优化失败: "+(r.message||"未知错误")),I.value=!1}},Q=()=>{k.value&&clearInterval(k.value);let l=0;const n=2;k.value=setInterval(async()=>{try{l<90&&(l+=n,j.value=Math.min(l,90));const i=(await ce.get(`/molecular-optimization/task/${V.value}`,{timeout:1e4})).data;console.log("任务状态检查结果:",i),i.status==="completed"?(clearInterval(k.value),k.value=null,j.value=100,setTimeout(()=>{I.value=!1,K.value=i.result,T.success("分子优化完成！")},500)):i.status==="failed"&&(clearInterval(k.value),k.value=null,I.value=!1,T.error("分子优化失败: "+(i.error_message||"未知错误")))}catch(r){console.error("检查任务进度失败:",r),r.code==="ERR_NETWORK"||r.message.includes("timeout")?console.log("网络错误，继续轮询..."):(clearInterval(k.value),k.value=null,I.value=!1,T.error("检查任务进度失败: "+(r.message||"未知错误")))}},2e3)},oe=()=>{W.value="",H.value=5,I.value=!1,V.value="",j.value=0,K.value=null,G.value=null,x.value=null,N.value=!1,L.value={smiles:"",molecular_Weight:0},k.value&&(clearInterval(k.value),k.value=null),T.info("已重置优化配置")},p=l=>{G.value=l,console.log("选中优化分子:",l),L.value.smiles=l.smiles,L.value.molecular_Weight=l.validation_info.molecular_weight,X(l.smiles)},X=async l=>{var n,r,i,c,o,u,P,E,S;if(!l||l==="Unknown"){console.log("无效的SMILES，跳过ADMET数据获取");return}try{N.value=!0,console.log("开始获取优化分子ADMET数据，SMILES:",l);const{drugAnalysisAPI:z}=await ve(async()=>{const{drugAnalysisAPI:O}=await import("./index-Dr8YfNte.js");return{drugAnalysisAPI:O}},__vite__mapDeps([0,1])),M={smiles:l,disease:"cancer",include_images:!0,include_radar_chart:!0};console.log("准备调用优化分子ADMET API，参数:",M);const v=await z.analyze(M);if(console.log("优化分子ADMET API响应:",v),v.data){const O=v.task_id||v.data.task_id;console.log("优化分子ADMET分析任务ID:",O);const h=v.data.Image_Paths||{};console.log("优化分子ADMET图片路径信息:",h),x.value={Radar_Chart_Data:v.data.Radar_Chart_Data||{Properties:["分子量","LogP","TPSA","氢键受体数","氢键供体数","可旋转键数"],Values:[((n=v.data.Physical_Chemical_Properties)==null?void 0:n["Molecular Weight"])||L.value.molecular_Weight,((r=v.data.Physical_Chemical_Properties)==null?void 0:r.LogP)||0,((i=v.data.Physical_Chemical_Properties)==null?void 0:i.TPSA)||0,((c=v.data.Physical_Chemical_Properties)==null?void 0:c["H-Bond Acceptors"])||0,((o=v.data.Physical_Chemical_Properties)==null?void 0:o["H-Bond Donors"])||0,((u=v.data.Physical_Chemical_Properties)==null?void 0:u["Rotatable Bonds"])||0],Upper_Limits:[500,5,140,10,5,10],Lower_Limits:[150,-1,20,0,0,0]},Physical_Chemical_Properties:v.data.Physical_Chemical_Properties||{},ADMET_Properties:v.data.ADMET_Properties||{},Disease_Related_Predictions:v.data.Disease_Related_Predictions||{},SIDER_Predictions:v.data.SIDER_Predictions||{},Image_Paths:h,task_id:O,SMILES:l},console.log("优化分子ADMET数据格式化成功:",x.value)}else throw new Error("API响应数据格式错误: 缺少data字段")}catch(z){console.error("获取优化分子ADMET数据失败:",z),console.error("错误详情:",{message:z.message,response:z.response,status:(P=z.response)==null?void 0:P.status,statusText:(E=z.response)==null?void 0:E.statusText,data:(S=z.response)==null?void 0:S.data}),T.error("优化分子ADMET数据获取失败: "+(z.message||"未知错误")),x.value={Radar_Chart_Data:{Properties:["分子量","LogP","TPSA","氢键受体数","氢键供体数","可旋转键数"],Values:[L.value.molecular_Weight,2.5,85.4,6,2,4],Upper_Limits:[500,5,140,10,5,10],Lower_Limits:[150,-1,20,0,0,0]},Physical_Chemical_Properties:{"Molecular Weight":L.value.molecular_Weight,LogP:2.5,TPSA:85.4,"H-Bond Acceptors":6,"H-Bond Donors":2,"Rotatable Bonds":4},ADMET_Properties:{Absorption:{Human_Intestinal_Absorption:{predicted_class:"High",confidence:.85}},Distribution:{},Metabolism:{},Excretion:{},Toxicity:{}},Disease_Related_Predictions:{},SIDER_Predictions:{},Image_Paths:{},task_id:null,SMILES:l},console.log("使用模拟优化分子ADMET数据作为后备")}finally{N.value=!1,console.log("优化分子ADMET数据获取完成，loading状态:",N.value)}};return Se(()=>{const l=s.state.filterResults,n=s.state.multiscoreResults,r=s.state.multiscoreResultUrls;if(console.log("FilterResults页面加载，检查store数据:"),console.log("- storedResults:",l),console.log("- multiscoreResults:",n),console.log("- multiscoreResultUrls:",r),!r)try{const i=localStorage.getItem("multiscoreResultUrls");if(i){const c=JSON.parse(i);s.dispatch("setMultiscoreResultUrls",c),console.log("从localStorage恢复了multiscoreResultUrls:",c)}}catch(i){console.warn("从localStorage恢复multiscoreResultUrls失败:",i)}if(l&&l.currentDrug){if(B.value=l.activeTopDrug||1,console.log("从store恢复了筛选结果数据"),l.allResults&&l.allResults.length>0){const i=l.allResults.sort((c,o)=>c.final_rank-o.final_rank);m.value.top_drugs=i.slice(0,3),console.log("从store恢复了完整的筛选结果数据，数量:",m.value.top_drugs.length),console.log("排序后的前3名药物:",m.value.top_drugs),console.log("药物排名顺序:",m.value.top_drugs.map(c=>`${c.drug_metadata.name}: 排名${c.final_rank}`)),setTimeout(()=>{const c=D.value;c&&c.drug_smiles&&c.drug_smiles!=="Unknown"&&(console.log("恢复数据后自动获取ADMET数据，SMILES:",c.drug_smiles),J(c.drug_smiles))},100)}}else if(n&&(n.all_drugs||n.top_10_drugs||n.top_drugs)){console.log("从store恢复了Multiscore结果数据:",n);let i=null;if(n.all_drugs&&Array.isArray(n.all_drugs)?i=n.all_drugs:n.top_10_drugs&&Array.isArray(n.top_10_drugs)?i=n.top_10_drugs:n.top_drugs&&Array.isArray(n.top_drugs)&&(i=n.top_drugs),i&&i.length>0){console.log("Multiscore结果数组长度:",i.length),console.log("Multiscore结果数组内容:",i),m.value.top_drugs=i.map((o,u)=>{var E,S,z,M,v,O,h,q,Y,de,ue,_e,ge,me;console.log(`处理第${u+1}个药物:`,o),console.log("药物数据结构:",o);const P={final_rank:o.final_rank||u+1,drug_metadata:{name:((E=o.drug_metadata)==null?void 0:E.name)||o.boltz_drug_name||o.name||`Drug ${u+1}`,category:((S=o.drug_metadata)==null?void 0:S.category)||o.category||"Unknown",molecular_formula:((z=o.drug_metadata)==null?void 0:z.molecular_formula)||o.molecular_formula||"Unknown",source:((M=o.drug_metadata)==null?void 0:M.source)||o.source||"Unknown",target:((v=o.drug_metadata)==null?void 0:v.target)||o.target||"Unknown"},scoring_data:{affinity_value:((O=o.scoring_data)==null?void 0:O.affinity_value)||o.raw_affinity||o.boltz_affinity_pred_value||0,affinity_binary:((h=o.scoring_data)==null?void 0:h.affinity_binary)||o.raw_affinity_binary||o.boltz_affinity_probability_binary||0,iptm:((q=o.scoring_data)==null?void 0:q.iptm)||o.raw_iptm||o.boltz_iptm||0,iplddt:((Y=o.scoring_data)==null?void 0:Y.iplddt)||o.raw_iplddt||o.boltz_complex_iplddt||0,bioscore:((de=o.scoring_data)==null?void 0:de.bioscore)||o.raw_bioscore||0},rankings:{affinity_binary:((ue=o.rankings)==null?void 0:ue.affinity_binary)||o.affinity_binary_rank||1,bioscore:((_e=o.rankings)==null?void 0:_e.bioscore)||o.bioscore_rank||1,iptm:((ge=o.rankings)==null?void 0:ge.iptm)||o.iptm_rank||1,iplddt:((me=o.rankings)==null?void 0:me.iplddt)||o.iplddt_rank||1},boltz_prediction_status:o.boltz_prediction_status||"completed",boltz_confidence_score:o.boltz_confidence_score||o.boltz_confidence||.9,boltz_ptm:o.boltz_ptm||o.boltz_complex_plddt||.9,boltz_prediction_time:o.boltz_prediction_time||o.boltz_time||100,drug_smiles:o.drug_smiles||o.smiles||"Unknown",protein_file:o.protein_file||"/path/to/protein.pdb",ligand_file:o.ligand_file||"/path/to/ligand.sdf",boltz_cif_file:o.boltz_cif_file||"/path/to/boltz_results.cif"};return console.log(`第${u+1}个药物映射结果:`,P),console.log(`药物名称: ${P.drug_metadata.name}`),console.log(`药物类别: ${P.drug_metadata.category}`),console.log(`分子式: ${P.drug_metadata.molecular_formula}`),console.log(`来源: ${P.drug_metadata.source}`),console.log(`靶点: ${P.drug_metadata.target}`),console.log(`最终排名: ${P.final_rank}`),P}),m.value.top_drugs.sort((o,u)=>o.final_rank-u.final_rank);const c=m.value.top_drugs.slice(0,3);m.value.top_drugs=c,console.log("排序后的前3名药物:",m.value.top_drugs),console.log("药物排名顺序:",m.value.top_drugs.map(o=>`${o.drug_metadata.name}: 排名${o.final_rank}`)),setTimeout(()=>{if(m.value.top_drugs.length>0){const o=m.value.top_drugs[0];o.drug_smiles&&o.drug_smiles!=="Unknown"&&(console.log("加载Multiscore结果后自动获取ADMET数据，SMILES:",o.drug_smiles),J(o.drug_smiles))}},100)}else console.warn("Multiscore结果中没有找到有效的药物数组")}else{console.log("FilterResults页面已加载，使用默认数据");try{const i=localStorage.getItem("filterResults");if(i){const c=JSON.parse(i);if(c.allResults&&c.allResults.length>0){const o=c.allResults.sort((u,P)=>u.final_rank-P.final_rank);m.value.top_drugs=o.slice(0,3),B.value=c.activeTopDrug||1,console.log("从localStorage恢复了筛选结果数据，数量:",m.value.top_drugs.length),console.log("排序后的前3名药物:",m.value.top_drugs),console.log("药物排名顺序:",m.value.top_drugs.map(u=>`${u.drug_metadata.name}: 排名${u.final_rank}`)),s.dispatch("setFilterResults",c),setTimeout(()=>{const u=m.value.top_drugs[0];u.drug_smiles&&u.drug_smiles!=="Unknown"&&(console.log("从localStorage恢复数据后自动获取ADMET数据，SMILES:",u.drug_smiles),J(u.drug_smiles))},100)}}}catch(i){console.warn("从localStorage恢复数据失败:",i)}}}),Le((l,n,r)=>{if(k.value&&(clearInterval(k.value),k.value=null,console.log("页面离开前清理了分子优化定时器")),m.value.top_drugs&&m.value.top_drugs.length>0){const i={currentDrug:D.value,activeTopDrug:B.value,allResults:m.value.top_drugs};s.dispatch("setFilterResults",i);try{localStorage.setItem("filterResults",JSON.stringify(i)),console.log("页面离开前保存了筛选结果状态到store和localStorage")}catch(o){console.warn("保存到localStorage失败:",o)}const c=s.state.multiscoreResultUrls;if(c)try{localStorage.setItem("multiscoreResultUrls",JSON.stringify(c)),console.log("页面离开前保存了multiscoreResultUrls到localStorage")}catch(o){console.warn("保存multiscoreResultUrls到localStorage失败:",o)}}r()}),{activeTopDrug:B,availableTopDrugs:$,currentDrug:D,mockResults:m,admetData:U,admetLoading:y,moleculeInfo:w,drugDeliveryLoading:t,switchTopDrug:ee,getFileName:se,goToPDBViewer:re,gotoDrugDelivery:ne,startOptimization:te,startProgressPolling:Q,resetOptimization:oe,optimizationModes:ie,selectedOptimizationMode:W,optimizationCount:H,optimizationLoading:I,optimizationTaskId:V,optimizationProgress:j,optimizationResult:K,selectedOptimizedMolecule:G,optimizedMoleculeAdmetData:x,optimizedMoleculeAdmetLoading:N,optimizedMoleculeInfo:L,selectOptimizedMolecule:p,fetchOptimizedMoleculeAdmetData:X}}},xe={class:"filter-results"},Ne={class:"header"},We={class:"content"},He={key:0,class:"top-drugs-tabs"},je=["onClick"],Je={key:1,class:"no-data-message"},qe={class:"content-display"},Ke={key:0,class:"drug-details"},Xe={class:"drug-card"},Ge={class:"card-header"},Qe={class:"rank-badge"},Ye={class:"card-content"},Ze={class:"info-row"},$e={class:"info-section info-left"},es={class:"section-title"},ss={class:"info-grid"},ts={class:"info-item"},os={class:"value"},ls={class:"info-item"},as={class:"value"},is={class:"info-item"},ns={class:"value"},rs={class:"info-section info-right"},cs={class:"section-title"},ds={class:"boltz-grid"},us={class:"boltz-item"},_s={class:"boltz-item"},gs={class:"value"},ms={class:"boltz-item"},ps={class:"value"},vs={class:"info-section"},fs={class:"section-title"},hs={class:"scoring-grid"},ys={class:"scoring-item"},Ds={class:"scoring-value"},bs={class:"scoring-binary"},Ps={class:"scoring-item"},ks={class:"scoring-value"},Ms={class:"scoring-rank"},zs={class:"scoring-item"},As={class:"scoring-value"},Rs={class:"scoring-rank"},Ts={class:"scoring-item"},Is={class:"scoring-value"},Es={class:"scoring-rank"},Ss={class:"info-section"},ws={class:"section-title"},Ls={class:"structure-info"},Cs={class:"smiles-display"},Us={class:"smiles-code"},Os={class:"files-info"},Fs={class:"file-item"},Bs={class:"value"},Vs={class:"file-item"},xs={class:"value"},Ns={class:"file-item"},Ws={key:1,class:"no-data"},Hs={key:2,class:"admet-section"},js={class:"section-header"},Js={class:"section-title"},qs={class:"admet-content"},Ks={class:"admet-left"},Xs={key:1,class:"admet-loading"},Gs={key:2,class:"admet-placeholder"},Qs={class:"admet-right"},Ys={key:1},Zs={key:2,class:"admet-loading"},$s={key:3,class:"admet-placeholder"},et={key:3,class:"molecular-optimization-section"},st={class:"section-header"},tt={class:"section-title"},ot={class:"optimization-content"},lt={key:0,class:"optimization-config"},at={class:"config-row"},it={class:"config-item"},nt={class:"mode-option"},rt={class:"mode-name"},ct={class:"mode-description"},dt={class:"config-item"},ut={class:"config-actions"},_t={key:1,class:"optimization-progress"},gt={class:"progress-bar-container"},mt={class:"progress-text"},pt={key:2,class:"optimization-results"},vt={class:"results-header"},ft={class:"results-summary"},ht={class:"molecules-grid"},yt=["onClick"],Dt={class:"molecule-header"},bt={class:"molecule-index"},Pt={class:"molecule-smiles"},kt={class:"smiles-code"},Mt={class:"molecule-description"},zt={class:"molecule-validation"},At={class:"validation-item"},Rt={class:"value"},Tt={class:"validation-item"},It={class:"value"},Et={class:"results-actions"},St={key:0,class:"optimization-admet-section"},wt={class:"admet-section-header"},Lt={class:"admet-section-title"},Ct={class:"admet-section-description"},Ut={class:"optimization-admet-content"},Ot={class:"optimization-admet-left"},Ft={key:1,class:"optimization-admet-loading"},Bt={key:2,class:"optimization-admet-placeholder"},Vt={class:"optimization-admet-right"},xt={key:1,class:"optimization-admet-loading"},Nt={key:2,class:"optimization-admet-placeholder"};function Wt(Z,s,B,t,$,m){var te,Q,oe;const U=b("ArrowLeft"),y=b("el-icon"),w=b("el-button"),ie=b("Trophy"),W=b("Medal"),H=b("Star"),I=b("el-empty"),V=b("el-tag"),j=b("InfoFilled"),K=b("Connection"),k=b("DataAnalysis"),G=b("Collection"),x=b("View"),N=b("articleDetail"),L=b("Loading"),D=b("rightlist"),ee=b("MagicStick"),se=b("el-option"),J=b("el-select"),ne=b("el-progress"),re=b("Refresh");return d(),f("div",xe,[e("div",Ne,[a(w,{onClick:s[0]||(s[0]=p=>Z.$router.push("/drug-filtering")),type:"text",class:"back-btn"},{default:_(()=>[a(y,null,{default:_(()=>[a(U)]),_:1}),s[3]||(s[3]=R(" 返回 ",-1))]),_:1,__:[3]}),s[4]||(s[4]=e("h1",null,"筛选结果",-1)),s[5]||(s[5]=e("p",{class:"subtitle"},"基于多维度评分的前三名药物候选物",-1))]),e("div",We,[t.mockResults.top_drugs&&t.mockResults.top_drugs.length>0?(d(),f("div",He,[(d(!0),f(le,null,ae(t.availableTopDrugs,p=>(d(),f("button",{key:p,class:fe(["tab-button",{active:t.activeTopDrug===p}]),onClick:X=>t.switchTopDrug(p)},[p===1?(d(),F(y,{key:0},{default:_(()=>[a(ie)]),_:1})):p===2?(d(),F(y,{key:1},{default:_(()=>[a(W)]),_:1})):(d(),F(y,{key:2},{default:_(()=>[a(H)]),_:1})),R(" Top "+g(p),1)],10,je))),128))])):C("",!0),!t.mockResults.top_drugs||t.mockResults.top_drugs.length===0?(d(),f("div",Je,[a(I,{description:"暂无筛选结果数据"})])):C("",!0),e("div",qe,[t.currentDrug&&t.mockResults.top_drugs&&t.mockResults.top_drugs.length>0?(d(),f("div",Ke,[e("div",Xe,[e("div",Ge,[e("h2",null,g(t.currentDrug.drug_metadata.name),1),e("div",Qe,[a(V,{type:"success",size:"large"},{default:_(()=>[R("Top "+g(t.activeTopDrug),1)]),_:1})])]),e("div",Ye,[e("div",Ze,[e("div",$e,[e("h3",es,[a(y,null,{default:_(()=>[a(j)]),_:1}),s[6]||(s[6]=R(" 基本信息 ",-1))]),e("div",ss,[e("div",ts,[s[7]||(s[7]=e("span",{class:"label"},"药物类别:",-1)),e("span",os,g(t.currentDrug.drug_metadata.category),1)]),e("div",ls,[s[8]||(s[8]=e("span",{class:"label"},"靶点:",-1)),e("span",as,g(t.currentDrug.drug_metadata.target),1)]),e("div",is,[s[9]||(s[9]=e("span",{class:"label"},"最终排名:",-1)),e("span",ns,g(t.currentDrug.final_rank),1)])])]),e("div",rs,[e("h3",cs,[a(y,null,{default:_(()=>[a(K)]),_:1}),s[10]||(s[10]=R(" Boltz预测结果 ",-1))]),e("div",ds,[e("div",us,[s[11]||(s[11]=e("span",{class:"label"},"预测状态:",-1)),a(V,{type:t.currentDrug.boltz_prediction_status==="completed"?"success":"warning",size:"small"},{default:_(()=>[R(g(t.currentDrug.boltz_prediction_status==="completed"?"已完成":"进行中"),1)]),_:1},8,["type"])]),e("div",_s,[s[12]||(s[12]=e("span",{class:"label"},"置信度评分:",-1)),e("span",gs,g((t.currentDrug.boltz_confidence_score*100).toFixed(1))+"%",1)]),e("div",ms,[s[13]||(s[13]=e("span",{class:"label"},"PTM评分:",-1)),e("span",ps,g((t.currentDrug.boltz_ptm*100).toFixed(1))+"%",1)])])])]),e("div",vs,[e("h3",fs,[a(y,null,{default:_(()=>[a(k)]),_:1}),s[14]||(s[14]=R(" 评分数据 ",-1))]),e("div",hs,[e("div",ys,[s[15]||(s[15]=e("div",{class:"scoring-label"},"亲和力评分",-1)),e("div",Ds,g(t.currentDrug.scoring_data.affinity_value.toFixed(3)),1),e("div",bs,"二进制: "+g((t.currentDrug.scoring_data.affinity_binary*100).toFixed(1))+"%",1)]),e("div",Ps,[s[16]||(s[16]=e("div",{class:"scoring-label"},"生物评分",-1)),e("div",ks,g(t.currentDrug.scoring_data.bioscore.toFixed(3)),1),e("div",Ms,"排名: "+g(t.currentDrug.rankings.bioscore),1)]),e("div",zs,[s[17]||(s[17]=e("div",{class:"scoring-label"},"IPTM评分",-1)),e("div",As,g(t.currentDrug.scoring_data.iptm.toFixed(3)),1),e("div",Rs,"排名: "+g(t.currentDrug.rankings.iptm),1)]),e("div",Ts,[s[18]||(s[18]=e("div",{class:"scoring-label"},"IPLDDT评分",-1)),e("div",Is,g(t.currentDrug.scoring_data.iplddt.toFixed(3)),1),e("div",Es,"排名: "+g(t.currentDrug.rankings.iplddt),1)])])]),e("div",Ss,[e("h3",ws,[a(y,null,{default:_(()=>[a(G)]),_:1}),s[19]||(s[19]=R(" 分子结构信息 ",-1))]),e("div",Ls,[e("div",Cs,[s[20]||(s[20]=e("span",{class:"label"},"SMILES:",-1)),e("div",Us,g(t.currentDrug.drug_smiles),1)]),e("div",Os,[e("div",Fs,[s[21]||(s[21]=e("span",{class:"label"},"蛋白质文件:",-1)),e("span",Bs,g(t.getFileName(t.currentDrug.protein_file)),1)]),e("div",Vs,[s[22]||(s[22]=e("span",{class:"label"},"配体文件:",-1)),e("span",xs,g(t.getFileName(t.currentDrug.ligand_file)),1)]),e("div",Ns,[s[24]||(s[24]=e("span",{class:"label"},"分子对接详情:",-1)),a(w,{type:"primary",size:"small",onClick:t.goToPDBViewer,class:"pdb-viewer-btn"},{default:_(()=>[a(y,null,{default:_(()=>[a(x)]),_:1}),s[23]||(s[23]=R(" 查看3D结构 ",-1))]),_:1,__:[23]},8,["onClick"])])])])])])])])):(d(),f("div",Ws,[a(I,{description:"暂无数据"},{description:_(()=>s[25]||(s[25]=[e("p",null,"请先完成药物筛选流程",-1)])),_:1})]))]),t.currentDrug&&t.currentDrug.drug_smiles?(d(),f("div",Hs,[e("div",js,[e("h3",Js,[a(y,null,{default:_(()=>[a(k)]),_:1}),s[26]||(s[26]=R(" ADMET性质分析 ",-1))]),s[27]||(s[27]=e("p",{class:"section-description"},"基于分子结构的ADMET性质预测分析",-1))]),e("div",qs,[e("div",Ks,[t.admetData&&!t.admetLoading?(d(),F(N,{key:0,detailObj:t.admetData},null,8,["detailObj"])):t.admetLoading?(d(),f("div",Xs,[a(y,{class:"loading-icon"},{default:_(()=>[a(L)]),_:1}),s[28]||(s[28]=e("p",null,"ADMET分析中...",-1))])):(d(),f("div",Gs,[a(I,{description:"暂无ADMET数据"})]))]),e("div",Qs,[t.admetData&&!t.admetLoading?(d(),F(D,{key:`original-admet-${((te=t.currentDrug)==null?void 0:te.drug_smiles)||"default"}`,chartId:`original-admet-chart-${((Q=t.currentDrug)==null?void 0:Q.drug_smiles)||"default"}`,info:t.moleculeInfo,detailObj:t.admetData},null,8,["chartId","info","detailObj"])):C("",!0),t.admetData&&!t.admetLoading?(d(),f("div",Ys,[a(w,{type:"primary",size:"large",onClick:t.gotoDrugDelivery,loading:t.drugDeliveryLoading,disabled:t.drugDeliveryLoading,class:"delivery-btn"},{default:_(()=>[t.drugDeliveryLoading?C("",!0):(d(),F(y,{key:0},{default:_(()=>[a(x)]),_:1})),R(" "+g(t.drugDeliveryLoading?"正在分析中...即将跳转..":"查看分子递进"),1)]),_:1},8,["onClick","loading","disabled"])])):t.admetLoading?(d(),f("div",Zs,[a(y,{class:"loading-icon"},{default:_(()=>[a(L)]),_:1}),s[29]||(s[29]=e("p",null,"ADMET分析中...",-1))])):(d(),f("div",$s,[a(I,{description:"暂无分子信息"})]))])])])):C("",!0),t.currentDrug&&t.currentDrug.drug_smiles?(d(),f("div",et,[e("div",st,[e("h3",tt,[a(y,null,{default:_(()=>[a(ee)]),_:1}),s[30]||(s[30]=R(" 分子优化 ",-1))]),s[31]||(s[31]=e("p",{class:"section-description"},"基于AI的分子结构优化，提升药物性质",-1))]),e("div",ot,[t.optimizationResult?C("",!0):(d(),f("div",lt,[e("div",at,[e("div",it,[s[32]||(s[32]=e("label",{class:"config-label"},"优化模式",-1)),a(J,{modelValue:t.selectedOptimizationMode,"onUpdate:modelValue":s[1]||(s[1]=p=>t.selectedOptimizationMode=p),placeholder:"请选择优化模式",class:"config-select"},{default:_(()=>[(d(!0),f(le,null,ae(t.optimizationModes,p=>(d(),F(se,{key:p.mode,label:p.mode,value:p.mode},{default:_(()=>[e("div",nt,[e("div",rt,g(p.mode),1),e("div",ct,g(p.description),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),e("div",dt,[s[33]||(s[33]=e("label",{class:"config-label"},"优化数量",-1)),a(J,{modelValue:t.optimizationCount,"onUpdate:modelValue":s[2]||(s[2]=p=>t.optimizationCount=p),placeholder:"请选择优化数量",class:"config-select"},{default:_(()=>[(d(),f(le,null,ae([1,2,3,4,5],p=>a(se,{key:p,label:`${p}个分子`,value:p},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])]),e("div",ut,[a(w,{type:"primary",size:"large",onClick:t.startOptimization,loading:t.optimizationLoading,disabled:!t.selectedOptimizationMode||!t.optimizationCount||t.optimizationLoading,class:"start-optimization-btn"},{default:_(()=>[t.optimizationLoading?C("",!0):(d(),F(y,{key:0},{default:_(()=>[a(ee)]),_:1})),R(" "+g(t.optimizationLoading?"优化中...":"开始优化"),1)]),_:1},8,["onClick","loading","disabled"])])])),t.optimizationLoading&&t.optimizationTaskId?(d(),f("div",_t,[s[34]||(s[34]=e("div",{class:"progress-header"},[e("h4",null,"优化进度")],-1)),e("div",gt,[a(ne,{percentage:t.optimizationProgress,"stroke-width":20,"show-text":!1,class:"progress-bar"},null,8,["percentage"]),e("div",mt,g(t.optimizationProgress)+"%",1)]),s[35]||(s[35]=e("div",{class:"progress-status"},[e("span",null,"AI正在优化分子结构，请稍候...")],-1))])):C("",!0),t.optimizationResult&&!t.optimizationLoading?(d(),f("div",pt,[e("div",vt,[s[36]||(s[36]=e("h4",null,"优化结果",-1)),e("div",ft,[a(V,{type:"success",size:"large"},{default:_(()=>[R(" 成功生成 "+g(t.optimizationResult.valid_molecule_count)+" 个有效分子 ",1)]),_:1})])]),e("div",ht,[(d(!0),f(le,null,ae(t.optimizationResult.valid_molecules,(p,X)=>(d(),f("div",{key:X,class:fe(["molecule-card",{selected:t.selectedOptimizedMolecule===p}]),onClick:l=>t.selectOptimizedMolecule(p)},[e("div",Dt,[e("span",bt,"#"+g(X+1),1),a(V,{type:"success",size:"small"},{default:_(()=>s[37]||(s[37]=[R("有效",-1)])),_:1,__:[37]})]),e("div",Pt,[s[38]||(s[38]=e("span",{class:"label"},"SMILES:",-1)),e("div",kt,g(p.smiles),1)]),e("div",Mt,[s[39]||(s[39]=e("span",{class:"label"},"优化说明:",-1)),e("p",null,g(p.description),1)]),e("div",zt,[e("div",At,[s[40]||(s[40]=e("span",{class:"label"},"分子量:",-1)),e("span",Rt,g(p.validation_info.molecular_weight.toFixed(2)),1)]),e("div",Tt,[s[41]||(s[41]=e("span",{class:"label"},"原子数:",-1)),e("span",It,g(p.validation_info.num_atoms),1)])])],10,yt))),128))]),e("div",Et,[a(w,{type:"primary",size:"large",onClick:t.resetOptimization,class:"reset-btn"},{default:_(()=>[a(y,null,{default:_(()=>[a(re)]),_:1}),s[42]||(s[42]=R(" 重新优化 ",-1))]),_:1,__:[42]},8,["onClick"])]),t.selectedOptimizedMolecule?(d(),f("div",St,[e("div",wt,[e("h4",Lt,[a(y,null,{default:_(()=>[a(k)]),_:1}),s[43]||(s[43]=R(" 优化分子ADMET性质分析 ",-1))]),e("p",Ct," 当前分析: "+g(t.selectedOptimizedMolecule.smiles),1)]),e("div",Ut,[e("div",Ot,[t.optimizedMoleculeAdmetData&&!t.optimizedMoleculeAdmetLoading?(d(),F(N,{key:0,detailObj:t.optimizedMoleculeAdmetData},null,8,["detailObj"])):t.optimizedMoleculeAdmetLoading?(d(),f("div",Ft,[a(y,{class:"loading-icon"},{default:_(()=>[a(L)]),_:1}),s[44]||(s[44]=e("p",null,"ADMET分析中...",-1))])):(d(),f("div",Bt,[a(I,{description:"暂无ADMET数据"})]))]),e("div",Vt,[t.optimizedMoleculeAdmetData&&!t.optimizedMoleculeAdmetLoading?(d(),F(D,{key:`optimized-molecule-${((oe=t.selectedOptimizedMolecule)==null?void 0:oe.smiles)||"default"}`,info:t.optimizedMoleculeInfo,detailObj:t.optimizedMoleculeAdmetData},null,8,["info","detailObj"])):t.optimizedMoleculeAdmetLoading?(d(),f("div",xt,[a(y,{class:"loading-icon"},{default:_(()=>[a(L)]),_:1}),s[45]||(s[45]=e("p",null,"ADMET分析中...",-1))])):(d(),f("div",Nt,[a(I,{description:"暂无分子信息"})]))])])])):C("",!0)])):C("",!0)])])):C("",!0)])])}const Kt=he(Ve,[["render",Wt],["__scopeId","data-v-92a791ae"]]);export{Kt as default};
